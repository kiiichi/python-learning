function() if (aura_env.LastUpdate and (aura_env.LastUpdate>(GetTime() -aura_env.config['UpdateFrequency']))) then return;end aura_env.LastUpdate=GetTime();local v2=GetTime();local v3=aura_env.OffCooldown;local v4=aura_env.OffCooldownNotCasting;local v5=aura_env.GetRemainingAuraDuration;local v6=aura_env.GetRemainingDebuffDuration;local v7=aura_env.GetRemainingSpellCooldown;local v8=aura_env.IsCasting;local v9=aura_env.GetPlayerStacks;local v10=aura_env.GetTargetStacks;local v11=aura_env.PlayerHasBuff;local v12=aura_env.TargetHasDebuff;local v13=aura_env.HasBloodlust;local v14=aura_env.GetSpellChargesFractional;local v15=aura_env.GetTimeToNextCharge;local v16=aura_env.GetTimeToFullCharges;local v17=aura_env.TargetTimeToXPct;local v18=aura_env.FightRemains;local v19=aura_env.IsAuraRefreshable;local v20=aura_env.KTrig;local v21=aura_env.KTrigCD;aura_env.FlagKTrigCD=true;local v23=aura_env.ids;aura_env.OutOfRange=false;local v25=UnitPower("player",Enum.PowerType.Focus);local v26=UnitPowerMax("player",Enum.PowerType.Focus);local v27=WeakAuras.GetNumSetItemsEquipped(1871);local v28=select(4 + 5 ,UnitCastingInfo("player"));if (v28~=nil) then if (v28==v23.SteadyShot) then v25=v25 + 10 ;elseif (v28==v23.AimedShot) then v25=v25-35 ;end end local v29=0;local v30=1886 -(1228 + 618) ;for v39=1 -0 ,158 -118  do local v40=952 -(802 + 150) ;local v41;while true do if (v40==(0 -0)) then v41="nameplate"   .. v39 ;if (UnitExists(v41) and  not UnitIsFriend("player",v41) and WeakAuras.CheckRange(v41,v30,"<=") and (UnitAffectingCombat(v41) or aura_env.config['BypassCombatRequirement'])) then v29=v29 + 1 ;end break;end end end WeakAuras.ScanEvents("K_NEARBY_ENEMIES",v29);local v31=v11(v23.PreciseShotsBuff) or v8(v23.AimedShot) ;local v32=v12(v23.SpottersMarkDebuff) and  not v8(v23.AimedShot) ;local v33=v11(v23.MovingTargetBuff) and  not v8(v23.AimedShot) ;local v34=v11(v23.LunarStormReadyBuff) or (v5("player",v23.LunarStormCooldownBuff,"HARMFUL")==0) ;local v35=v11(v23.Volley) or (v11(v23.TrickShotsBuff) and  not v8(v23.AimedShot) and  not (select(8,UnitChannelInfo("player"))==v23.RapidFire) and  not (aura_env.PrevCast==v23.RapidFire)) ;if aura_env.config['NeedTarget'] then if ((UnitExists("target")==false) or (UnitCanAttack("player","target")==false)) then local v52=0 -0 ;while true do if (v52==1) then v21("Clear",nil);return;end if (v52==0) then WeakAuras.ScanEvents("K_TRIGED_EXTRA",{});v20("Clear",nil);v52=1 + 0 ;end end end end local v36={};if (v3(v23.Trueshot) and (v29>(997 -(915 + 82))) and (v29<3) and v33 and ( not IsPlayerSpell(v23.BulletstormTalent) or (v9(v23.BulletstormBuff)>7))) then v36.Trueshot=true;end if (v3(v23.Trueshot) and (v29>2) and v33 and ( not IsPlayerSpell(v23.BulletstormTalent) or (v9(v23.BulletstormBuff)>7)) and  not v3(v23.Volley)) then v36.Trueshot=true;end WeakAuras.ScanEvents("K_TRIGED_EXTRA",v36);local v37=function() if (v3(v23.Volley) and  not IsPlayerSpell(v23.DoubleTapTalent) and (IsPlayerSpell(v23.AspectOfTheHydraTalent) or (v29==(2 -1)) or ( not v31 and (((v7(v23.RapidFire) + max(C_Spell.GetSpellInfo(v23.RapidFire).castTime/1000 ,WeakAuras.gcdDuration()))<6) or  not IsPlayerSpell(v23.BulletstormTalent))))) then if ((aura_env.config[tostring(v23.Volley)]==true) and aura_env.FlagKTrigCD) then v21("Volley");elseif (aura_env.config[tostring(v23.Volley)]~=true) then local v53=0 + 0 ;while true do if (v53==(0 -0)) then v20("Volley");return true;end end end end if (v3(v23.RapidFire) and ((IsPlayerSpell(v23.SentinelTalent) and v34) or ( not IsPlayerSpell(v23.AspectOfTheHydraTalent) and IsPlayerSpell(v23.BulletstormTalent) and (v29>1) and v35 and ( not v31 or  not IsPlayerSpell(v23.NoScopeTalent))))) then if ((aura_env.config[tostring(v23.RapidFire)]==true) and aura_env.FlagKTrigCD) then v21("Rapid Fire");elseif (aura_env.config[tostring(v23.RapidFire)]~=true) then v20("Rapid Fire");return true;end end if (v3(v23.ExplosiveShot) and IsPlayerSpell(v23.PrecisionDetonationTalent) and (v27>=(1191 -(1069 + 118))) and ( not v31 or (v32 and v33)) and v11(v23.LockAndLoadBuff)) then if ((aura_env.config[tostring(v23.ExplosiveShot)]==true) and aura_env.FlagKTrigCD) then v21("Explosive Shot");elseif (aura_env.config[tostring(v23.ExplosiveShot)]~=true) then local v54=0 -0 ;while true do if (v54==0) then v20("Explosive Shot");return true;end end end end if (v3(v23.AimedShot) and  not (v8(v23.AimedShot) and (C_Spell.GetSpellCharges(v23.AimedShot).currentCharges==(1 -0))) and IsPlayerSpell(v23.PrecisionDetonationTalent) and (v27>=(1 + 3)) and ( not v31 or (v32 and v33)) and v11(v23.LockAndLoadBuff)) then v20("Aimed Shot");return true;end if (v3(v23.Volley) and IsPlayerSpell(v23.DoubleTapTalent) and (v11(v23.DoubleTapBuff)==false)) then if ((aura_env.config[tostring(v23.Volley)]==true) and aura_env.FlagKTrigCD) then v21("Volley");elseif (aura_env.config[tostring(v23.Volley)]~=true) then local v55=0 -0 ;while true do if (v55==(0 + 0)) then v20("Volley");return true;end end end end if (v3(v23.KillShot) and (FindSpellOverrideByID(v23.KillShot)==v23.BlackArrow) and ((IsPlayerSpell(v23.HeadshotTalent) and v31 and ( not v32 or  not v33)) or ( not IsPlayerSpell(v23.HeadshotTalent) and v11(v23.RazorFragmentsBuff)))) then v20("Black Arrow");return true;end if (v3(v23.KillShot) and ((IsPlayerSpell(v23.HeadshotTalent) and v31 and ( not v32 or  not v33)) or ( not IsPlayerSpell(v23.HeadshotTalent) and v11(v23.RazorFragmentsBuff)))) then local v44=0;while true do if (v44==(791 -(368 + 423))) then v20("Kill Shot");return true;end end end if (v3(v23.Multishot) and v31 and ( not v32 or  not v33) and (v29>(3 -2)) and  not IsPlayerSpell(v23.AspectOfTheHydraTalent) and (IsPlayerSpell(v23.SymphonicArsenalTalent) or IsPlayerSpell(v23.SmallGameHunterTalent))) then v20("Multishot");return true;end if (v3(v23.ArcaneShot) and v31 and ( not v32 or  not v33)) then local v45=18 -(10 + 8) ;while true do if (v45==0) then v20("Arcane Shot");return true;end end end if (v3(v23.AimedShot) and  not (v8(v23.AimedShot) and (C_Spell.GetSpellCharges(v23.AimedShot).currentCharges==(3 -2))) and ( not v31 or (v32 and v33)) and (v16(v23.AimedShot)<(max(C_Spell.GetSpellInfo(v23.RapidFire).castTime/(1442 -(416 + 26)) ,WeakAuras.gcdDuration()) + (C_Spell.GetSpellInfo(v23.AimedShot).castTime/(3192 -2192)))) and ( not IsPlayerSpell(v23.BulletstormTalent) or v11(v23.BulletstormBuff)) and IsPlayerSpell(v23.WindrunnerQuiverTalent)) then local v46=0 + 0 ;while true do if (v46==(0 -0)) then v20("Aimed Shot");return true;end end end if (v3(v23.RapidFire) and ( not IsPlayerSpell(v23.SentinelTalent) or (v5("player",v23.LunarStormCooldownBuff,"HARMFUL")>((GetSpellBaseCooldown(v23.RapidFire)/(1438 -(145 + 293)))/(433 -(44 + 386))))) and ( not IsPlayerSpell(v23.BulletstormTalent) or (v9(v23.BulletstormBuff)<=(1496 -(998 + 488))) or (IsPlayerSpell(v23.AspectOfTheHydraTalent) and (v29>(1 + 0))))) then if ((aura_env.config[tostring(v23.RapidFire)]==true) and aura_env.FlagKTrigCD) then v21("Rapid Fire");elseif (aura_env.config[tostring(v23.RapidFire)]~=true) then local v56=0;while true do if ((0 + 0)==v56) then v20("Rapid Fire");return true;end end end end if (v3(v23.AimedShot) and  not (v8(v23.AimedShot) and (C_Spell.GetSpellCharges(v23.AimedShot).currentCharges==(773 -(201 + 571)))) and ( not v31 or (v32 and v33))) then v20("Aimed Shot");return true;end if (v3(v23.ExplosiveShot) and ( not (v27>=(1142 -(116 + 1022))) or  not IsPlayerSpell(v23.PrecisionDetonationTalent))) then if ((aura_env.config[tostring(v23.ExplosiveShot)]==true) and aura_env.FlagKTrigCD) then v21("Explosive Shot");elseif (aura_env.config[tostring(v23.ExplosiveShot)]~=true) then v20("Explosive Shot");return true;end end if (v3(v23.KillShot) and (FindSpellOverrideByID(v23.KillShot)==v23.BlackArrow) and  not IsPlayerSpell(v23.HeadshotTalent)) then local v47=0 -0 ;while true do if (v47==(0 + 0)) then v20("Black Arrow");return true;end end end if v3(v23.SteadyShot) then local v48=0 -0 ;while true do if (v48==0) then v20("Steady Shot");return true;end end end end;local v38=function() if (v3(v23.Volley) and  not IsPlayerSpell(v23.DoubleTapTalent) and v35 and  not v3(v23.RapidFire) and v3(v23.Trueshot)) then if ((aura_env.config[tostring(v23.Volley)]==true) and aura_env.FlagKTrigCD) then v21("Volley");elseif (aura_env.config[tostring(v23.Volley)]~=true) then v20("Volley");return true;end end if (v3(v23.Volley) and  not IsPlayerSpell(v23.DoubleTapTalent) and (v7(v23.Trueshot)>(35 -25))) then if ((aura_env.config[tostring(v23.Volley)]==true) and aura_env.FlagKTrigCD) then v21("Volley");elseif (aura_env.config[tostring(v23.Volley)]~=true) then v20("Volley");return true;end end if (v3(v23.Multishot) and ((v31 and ( not v32 or  not v33)) or  not v35 or (v5("player",v23.TrickShotsBuff)<=WeakAuras.gcdDuration()))) then v20("Multishot");return true;end if (v3(v23.Volley) and IsPlayerSpell(v23.DoubleTapTalent) and (v11(v23.DoubleTapBuff)==false)) then if ((aura_env.config[tostring(v23.Volley)]==true) and aura_env.FlagKTrigCD) then v21("Volley");elseif (aura_env.config[tostring(v23.Volley)]~=true) then v20("Volley");return true;end end if (v3(v23.ExplosiveShot) and v3(v23.Trueshot) and v35 and  not v3(v23.Volley)) then if ((aura_env.config[tostring(v23.ExplosiveShot)]==true) and aura_env.FlagKTrigCD) then v21("Explosive Shot");elseif (aura_env.config[tostring(v23.ExplosiveShot)]~=true) then v20("Explosive Shot");return true;end end if (v3(v23.KillShot) and (FindSpellOverrideByID(v23.KillShot)==v23.BlackArrow) and v35) then local v49=0;while true do if (v49==(859 -(814 + 45))) then v20("Black Arrow");return true;end end end if (v3(v23.AimedShot) and  not (v8(v23.AimedShot) and (C_Spell.GetSpellCharges(v23.AimedShot).currentCharges==(2 -1))) and ( not v31 or (v32 and v33)) and v35 and v11(v23.BulletstormBuff) and (v16(v23.AimedShot)<=max(C_Spell.GetSpellInfo(v23.AimedShot).castTime/(54 + 946) ,WeakAuras.gcdDuration()))) then local v50=0 + 0 ;while true do if (v50==(885 -(261 + 624))) then v20("Aimed Shot");return true;end end end if (v3(v23.RapidFire) and (v5("player",v23.TrickShotsBuff)>max(C_Spell.GetSpellInfo(v23.RapidFire).castTime/(1777 -777) ,WeakAuras.gcdDuration())) and ( not IsPlayerSpell(v23.SentinelTalent) or (v5("player",v23.LunarStormCooldownBuff,"HARMFUL")>((GetSpellBaseCooldown(v23.RapidFire)/(2080 -(1020 + 60)))/(1426 -(630 + 793)))) or v34)) then if ((aura_env.config[tostring(v23.RapidFire)]==true) and aura_env.FlagKTrigCD) then v21("Rapid Fire");elseif (aura_env.config[tostring(v23.RapidFire)]~=true) then v20("Rapid Fire");return true;end end if (v3(v23.ExplosiveShot) and IsPlayerSpell(v23.PrecisionDetonationTalent) and (v11(v23.LockAndLoadBuff) or  not (v27>=4)) and ( not v31 or (v32 and v33))) then if ((aura_env.config[tostring(v23.ExplosiveShot)]==true) and aura_env.FlagKTrigCD) then v21("Explosive Shot");elseif (aura_env.config[tostring(v23.ExplosiveShot)]~=true) then local v57=0 -0 ;while true do if (v57==(0 -0)) then v20("Explosive Shot");return true;end end end end if (v3(v23.AimedShot) and  not (v8(v23.AimedShot) and (C_Spell.GetSpellCharges(v23.AimedShot).currentCharges==1)) and ( not v31 or (v32 and v33)) and v35) then v20("Aimed Shot");return true;end if (v3(v23.ExplosiveShot) and v35) then if ((aura_env.config[tostring(v23.ExplosiveShot)]==true) and aura_env.FlagKTrigCD) then v21("Explosive Shot");elseif (aura_env.config[tostring(v23.ExplosiveShot)]~=true) then local v58=0 + 0 ;while true do if (v58==(0 -0)) then v20("Explosive Shot");return true;end end end end if (v3(v23.SteadyShot) and ((v25 + (1787 -(760 + 987)))<v26)) then v20("Steady Shot");return true;end if v3(v23.Multishot) then local v51=1913 -(1789 + 124) ;while true do if (v51==0) then v20("Multishot");return true;end end end end;if ((v29<(769 -(745 + 21))) or  not IsPlayerSpell(v23.TrickShotsTalent)) then if v37() then return true;end end if (v29>(1 + 1)) then if v38() then return true;end end v20("Clear");end;