function() if (aura_env.LastUpdate and (aura_env.LastUpdate>(GetTime() -aura_env.config['UpdateFrequency']))) then return;end aura_env.LastUpdate=GetTime();local v2=GetTime();local v3=aura_env.OffCooldown;local v4=aura_env.OffCooldownNotCasting;local v5=aura_env.GetRemainingAuraDuration;local v6=aura_env.GetRemainingDebuffDuration;local v7=aura_env.GetRemainingSpellCooldown;local v8=aura_env.IsCasting;local v9=aura_env.GetPlayerStacks;local v10=aura_env.GetTargetStacks;local v11=aura_env.PlayerHasBuff;local v12=aura_env.TargetHasDebuff;local v13=aura_env.HasBloodlust;local v14=aura_env.GetSpellChargesFractional;local v15=aura_env.GetTimeToNextCharge;local v16=aura_env.GetTimeToFullCharges;local v17=aura_env.TargetTimeToXPct;local v18=aura_env.FightRemains;local v19=aura_env.IsAuraRefreshable;local v20=aura_env.KTrig;local v21=aura_env.KTrigCD;aura_env.FlagKTrigCD=true;local v23=aura_env.ids;if IsPlayerSpell(457277 -(23 + 212) ) then v23.ShadowCrash=185548 + 271494 ;end aura_env.OutOfRange=false;local v25=WeakAuras.GetNumSetItemsEquipped(3773 -(1228 + 618) );local v26=UnitPower("player",Enum.PowerType.Insanity);local v27=UnitPowerMax("player",Enum.PowerType.Insanity);local v28=0 -0 ;local v29=182 -136 ;local v30=952 -(802 + 150) ;local v31=0;local v32=0 -0 ;for v45=1,40 do local v46="nameplate"   .. v45 ;if (UnitExists(v46) and  not UnitIsFriend("player",v46) and WeakAuras.CheckRange(v46,v29,"<=") and (UnitAffectingCombat(v46) or aura_env.config['BypassCombatRequirement'])) then v28=v28 + (1 -0) ;local v51=false;for v57,v58 in ipairs(_G.KLIST.ShadowPriest) do if ((UnitName(v46)==v58) or (select(5 + 1 ,strsplit("-",UnitGUID(v46)))==v58)) then v51=true;break;end end if (v51==false) then if (WA_GetUnitDebuff(v46,v23.VampiricTouch,"PLAYER|HARMFUL")~=nil) then v31=v31 + (998 -(915 + 82)) ;elseif (UnitClassification(v46)~="minus") then v30=v30 + (2 -1) ;end if (WA_GetUnitDebuff(v46,v23.DevouringPlague,"PLAYER|HARMFUL")~=nil) then v32=v32 + 1 ;end end end end WeakAuras.ScanEvents("K_NEARBY_ENEMIES",v28);local v33=max(0,aura_env.ShadowfiendExpiration-GetTime() );if ((UnitExists("target")==false) or (UnitCanAttack("player","target")==false)) then local v50=0;while true do if (v50==(0 + 0)) then WeakAuras.ScanEvents("K_TRIGED_EXTRA",{});v20("Clear",nil);v50=1;end if (v50==(1 -0)) then return;end end end local v34={};WeakAuras.ScanEvents("K_TRIGED_EXTRA",v34,nil);local v35={};v35.DrForcePrio=true;v35.MeForcePrio=true;v35.MaxVts=1199 -(1069 + 118) ;v35.IsVtPossible=false;v35.HoldingCrash=false;local v41=function() local v47=0;while true do if (v47==(2 -1)) then if (v17(0 -0 ,60)>=(4 + 14)) then v35.IsVtPossible=true;end v35.DotsUp=((v31 + ((13 -5) * ((((GetTime() -aura_env.LastShadowCrash)<(2 + 0)) and (792 -(368 + 423))) or 0)))>=v35.MaxVts) or  not v35.IsVtPossible ;v47=2;end if (2==v47) then if (v35.HoldingCrash and IsPlayerSpell(v23.ShadowCrash)) then v35.HoldingCrash=(v35.MaxVts-v31)<(12 -8) ;end v35.ManualVtsApplied=((v31 + ((26 -(10 + 8)) * (( not v35.HoldingCrash and (3 -2)) or 0)))>=v35.MaxVts) or  not v35.IsVtPossible ;break;end if (v47==(442 -(416 + 26))) then v35.MaxVts=min(v28,38 -26 );v35.IsVtPossible=false;v47=1;end end end;local v42=function() local v48=0 + 0 ;while true do if (v48==1) then if (v3(v23.ShadowCrash) and (( not v35.HoldingCrash and v19(v23.VampiricTouchDebuff)) or ((v6("target",v23.VampiricTouchDebuff)<=v17(0 -0 ,498 -(145 + 293) )) and  not v11(v23.VoidformBuff)))) then if ((aura_env.config[tostring(v23.ShadowCrash)]==true) and aura_env.FlagKTrigCD) then v21("Shadow Crash");elseif (aura_env.config[tostring(v23.ShadowCrash)]~=true) then v20("Shadow Crash");return true;end end break;end if (v48==0) then if v41() then return true;end if (v4(v23.VampiricTouch) and v19(v23.VampiricTouchDebuff) and (v17(430 -(44 + 386) ,60)>=18) and (v12(v23.VampiricTouchDebuff) or  not v35.DotsUp) and (v35.MaxVts>(1486 -(998 + 488))) and  not v35.ManualVtsApplied and  not ((GetTime() -aura_env.LastShadowCrash)<2) and  not v11(v23.EntropicRiftBuff)) then local v65=0;while true do if ((0 + 0)==v65) then v20("Vampiric Touch");return true;end end end v48=1 + 0 ;end end end;local v43=function() if (v4(v23.Halo) and IsPlayerSpell(v23.PowerSurgeTalent) and (((v33>0) and (v33>=(776 -(201 + 571))) and IsPlayerSpell(v23.Mindbender)) or ( not IsPlayerSpell(v23.Mindbender) and  not v3(v23.Shadowfiend)) or ((v28>(1140 -(116 + 1022))) and  not IsPlayerSpell(v23.InescapableTormentTalent)) or  not IsPlayerSpell(v23.DarkAscension)) and ((C_Spell.GetSpellCharges(v23.MindBlast).currentCharges==(0 -0)) or  not v3(v23.VoidTorrent) or  not IsPlayerSpell(v23.VoidEruption) or (v7(v23.VoidEruption)>=((1.5 + 0) * 4)) or (v11(v23.MindDevourerBuff) and IsPlayerSpell(v23.MindDevourerTalent)))) then if ((aura_env.config[tostring(v23.Halo)]==true) and aura_env.FlagKTrigCD) then v21("Halo");elseif (aura_env.config[tostring(v23.Halo)]~=true) then v20("Halo");return true;end end if (v4(v23.VoidEruption) and (((((v33>(0 -0)) and (v33>=(14 -10))) or ( not IsPlayerSpell(v23.Mindbender) and  not v3(v23.Shadowfiend)) or ((v28>(861 -(814 + 45))) and  not IsPlayerSpell(v23.InescapableTormentTalent))) and (C_Spell.GetSpellCharges(v23.MindBlast).currentCharges==0)) or (v11(v23.MindDevourerBuff) and IsPlayerSpell(v23.MindDevourerTalent)) or v11(v23.PowerSurgeBuff))) then if ((aura_env.config[tostring(v23.VoidEruption)]==true) and aura_env.FlagKTrigCD) then v21("Void Eruption");elseif (aura_env.config[tostring(v23.VoidEruption)]~=true) then v20("Void Eruption");return true;end end if (v4(v23.DarkAscension) and (((v33>(0 -0)) and (v33>=(1 + 3))) or ( not IsPlayerSpell(v23.Mindbender) and  not v3(v23.Shadowfiend)) or ((v28>2) and  not IsPlayerSpell(v23.InescapableTormentTalent))) and ((v32>=1) or (v26>=((((8 + 12) -((890 -(261 + 624)) * (( not IsPlayerSpell(v23.MindsEyeTalent) and (1 -0)) or (1080 -(1020 + 60))))) + ((1428 -(630 + 793)) * ((IsPlayerSpell(v23.DistortedRealityTalent) and (3 -2)) or (0 -0)))) -((((v33>0) and 1) or (0 + 0)) * (6 -4)))))) then if ((aura_env.config[tostring(v23.DarkAscension)]==true) and aura_env.FlagKTrigCD) then v21("Dark Ascension");elseif (aura_env.config[tostring(v23.DarkAscension)]~=true) then v20("Dark Ascension");return true;end end end;local v44=function() if (v28<3) then v35.DotsUp=v12(v23.VampiricTouchDebuff) or v8(v23.VampiricTouch) or ((GetTime() -aura_env.LastShadowCrash)<(1749 -(760 + 987))) ;end if ((v18(1973 -(1789 + 124) ,v29)<(796 -(745 + 21))) or ((v17(0,21 + 39 )>15) and ( not v35.HoldingCrash or (v28>(5 -3))))) then if v43() then return true;end end if (v3(v23.DevouringPlague) and v11(v23.VoidformBuff) and IsPlayerSpell(v23.PerfectedFormTalent) and ((v5("player",v23.VoidformBuff) -0.5)<=max((3.5 -2)/(1 + ((0.01 + 0) * UnitSpellHaste("player"))) ,0.75)) and IsPlayerSpell(v23.VoidEruption)) then v20("Devouring Plague","Glow");return true;end if (v3(v23.Shadowfiend) and (v7(v23.Mindbender)==0) and (v7(v23.Voidwraith)==0) and ((v12(v23.ShadowWordPain) and v35.DotsUp) or ((GetTime() -aura_env.LastShadowCrash)<(2 + 0))) and ( not v3(v23.Halo) or  not IsPlayerSpell(v23.PowerSurgeTalent)) and ((v18(1115 -(87 + 968) ,v29)<(132 -102)) or (v17(0 + 0 ,60)>(33 -18))) and ( not IsPlayerSpell(v23.DarkAscension) or (v7(v23.DarkAscension)<(1414.5 -(447 + 966))) or (v18(164 -104 ,v29)<(1832 -(1703 + 114))))) then if ((aura_env.config[tostring(v23.Shadowfiend)]==true) and aura_env.FlagKTrigCD) then v21("Shadowfiend");elseif (aura_env.config[tostring(v23.Shadowfiend)]~=true) then v20("Shadowfiend");return true;end end if (v3(v23.ShadowWordDeath) and (UnitGetTotalAbsorbs("target")>(701 -(376 + 325))) and IsPlayerSpell(v23.DevourMatterTalent)) then v20("Shadow Word Death");return true;end if (v4(v23.VoidBlast) and ((v6("target",v23.DevouringPlague)>=max(C_Spell.GetSpellInfo(v23.VoidBlast).castTime/(1638 -638) ,WeakAuras.gcdDuration())) or (v5("player",v23.EntropicRiftBuff)<=(2.5 -1)) or ((select(8,UnitChannelInfo("player"))==v23.VoidTorrent) and IsPlayerSpell(v23.VoidEmpowermentTalent))) and (((v27-v26)>=16) or (v16(v23.MindBlast)<=(1.5 + 0)) or (v5("player",v23.EntropicRiftBuff)<=(2.5 -1)))) then v20("Void Blast");return true;end if (v3(v23.DevouringPlague) and v11(v23.VoidformBuff) and IsPlayerSpell(v23.PerfectedFormTalent) and (v5("player",v23.VoidformBuff)<=max((15.5 -(9 + 5))/((377 -(85 + 291)) + ((1265.01 -(243 + 1022)) * UnitSpellHaste("player"))) ,0.75)) and IsPlayerSpell(v23.VoidEruption)) then v20("Devouring Plague");return true;end if ((v7(v23.VoidBolt)==(0 -0)) and  not v8(v23.VoidBolt) and (v11(v23.VoidformBuff) or v8(v23.VoidEruption)) and ((v27-v26)>16) and (v7(v23.VoidBolt)<=(0.1 + 0))) then if ((aura_env.config[tostring(v23.VoidEruption)]==true) and aura_env.FlagKTrigCD) then v21("Void Bolt");elseif (aura_env.config[tostring(v23.VoidEruption)]~=true) then local v66=0;while true do if (v66==(1180 -(1123 + 57))) then v20("Void Bolt");return true;end end end end if (v3(v23.DevouringPlague) and (((v32<=1) and (v6("target",v23.DevouringPlague)<=1.5) and ( not IsPlayerSpell(v23.VoidEruption) or (v7(v23.VoidEruption)>=((1.5 + 0) * 3)))) or ((v27-v26)<=(289 -(163 + 91))) or v11(v23.MindDevourerBuff) or v11(v23.EntropicRiftBuff) or (v11(v23.PowerSurgeBuff) and (v25>=4) and IsPlayerSpell(v23.PowerSurgeTalent) and (aura_env.Archon4pcStacks<(1934 -(1869 + 61))) and v11(v23.AscensionBuff)))) then local v53=0;while true do if ((0 + 0)==v53) then v20("Devouring Plague");return true;end end end if (v4(v23.VoidTorrent) and  not v35.HoldingCrash and (((v6("target",v23.DevouringPlagueDebuff)>=(6.5 -4)) and ((v7(v23.DarkAscension)>=(17 -5)) or  not IsPlayerSpell(v23.DarkAscension) or  not IsPlayerSpell(v23.VoidBlastTalent))) or ((v7(v23.VoidEruption)<=(1 + 2)) and IsPlayerSpell(v23.VoidEruption)))) then if ((aura_env.config[tostring(v23.VoidTorrent)]==true) and aura_env.FlagKTrigCD) then v21("Void Torrent");elseif (aura_env.config[tostring(v23.VoidTorrent)]~=true) then local v67=0 -0 ;while true do if (v67==0) then v20("Void Torrent");return true;end end end end if (v11(v23.VoidVolleyBuff) and ((v5("player",v23.VoidVolleyBuff)<=(5 + 0)) or (v11(v23.EntropicRiftBuff) and (v7(v23.VoidBlast)>v5("player",v23.EntropicRiftBuff))) or (v17(1474 -(1329 + 145) ,1031 -(140 + 831) )<=(1855 -(1409 + 441))))) then if ((aura_env.config[tostring(v23.VoidTorrent)]==true) and aura_env.FlagKTrigCD) then v21("Void Volley");elseif (aura_env.config[tostring(v23.VoidTorrent)]~=true) then local v68=0;while true do if (v68==0) then v20("Void Volley");return true;end end end end if (v3(v23.MindFlay) and (v11(v23.MindFlayInsanityBuff))) then v20("Mind Flay");return true;end if (v3(v23.ShadowCrash) and v19(v23.VampiricTouchDebuff) and  not v35.HoldingCrash and  not ((GetTime() -aura_env.LastShadowCrash)<(720 -(15 + 703)))) then if ((aura_env.config[tostring(v23.ShadowCrash)]==true) and aura_env.FlagKTrigCD) then v21("Shadow Crash");elseif (aura_env.config[tostring(v23.ShadowCrash)]~=true) then local v69=0;while true do if (v69==(0 + 0)) then v20("Shadow Crash");return true;end end end end if (v4(v23.VampiricTouch) and v19(v23.VampiricTouchDebuff) and (v17(0,498 -(262 + 176) )>(1733 -(345 + 1376))) and (v12(v23.VampiricTouchDebuff) or  not v35.DotsUp) and ((v35.MaxVts>(688 -(198 + 490))) or (v28<=(4 -3))) and ((v7(v23.ShadowCrash)>=v6("target",v23.VampiricTouchDebuff)) or v35.HoldingCrash or  not IsPlayerSpell(v23.ShadowCrash)) and ( not ((GetTime() -aura_env.LastShadowCrash)<2) or  not IsPlayerSpell(v23.ShadowCrash))) then local v54=0;while true do if (v54==(0 -0)) then v20("Vampiric Touch");return true;end end end if (v3(v23.MindBlast) and ((C_Spell.GetSpellCharges(v23.MindBlast).currentCharges>1) or  not v8(v23.MindBlast)) and ( not v11(v23.MindDevourerBuff) or  not IsPlayerSpell(v23.MindDevourerTalent) or (v3(v23.VoidEruption) and IsPlayerSpell(v23.VoidEruption)))) then v20("Mind Blast");return true;end if v11(v23.VoidVolleyBuff) then v20("Void Volley");return true;end if (v3(v23.DevouringPlague) and ((v11(v23.VoidformBuff) and IsPlayerSpell(v23.VoidEruption)) or v11(v23.PowerSurgeBuff) or IsPlayerSpell(v23.DistortedRealityTalent))) then v20("Devouring Plague");return true;end if (v4(v23.Halo) and (v28>(1207 -(696 + 510)))) then if ((aura_env.config[tostring(v23.Halo)]==true) and aura_env.FlagKTrigCD) then v21("Halo");elseif (aura_env.config[tostring(v23.Halo)]~=true) then local v70=0;while true do if (v70==0) then v20("Halo");return true;end end end end if (v3(v23.ShadowCrash) and  not v35.HoldingCrash and IsPlayerSpell(v23.DescendingDarknessTalent)) then if ((aura_env.config[tostring(v23.ShadowCrash)]==true) and aura_env.FlagKTrigCD) then v21("Shadow Crash");elseif (aura_env.config[tostring(v23.ShadowCrash)]~=true) then v20("Shadow Crash");return true;end end if (v3(v23.ShadowWordDeath) and (((UnitHealth("target")/UnitHealthMax("target")) * (209 -109))<(20 + ((1277 -(1091 + 171)) * ((IsPlayerSpell(v23.DeathspeakerTalent) and (1 + 0)) or (0 -0)))))) then v20("Shadow Word Death");return true;end if (v3(v23.ShadowWordDeath) and IsPlayerSpell(v23.InescapableTormentTalent) and (v33>0)) then local v55=0;while true do if (v55==(0 -0)) then v20("Shadow Word Death");return true;end end end if v3(v23.MindFlay) then local v56=0;while true do if (v56==(374 -(123 + 251))) then v20("Mind Flay");return true;end end end if v3(v23.DivineStar) then if ((aura_env.config[tostring(v23.DivineStar)]==true) and aura_env.FlagKTrigCD) then v21("Divine Star");elseif (aura_env.config[tostring(v23.DivineStar)]~=true) then local v71=0 -0 ;while true do if (v71==0) then v20("Divine Star");return true;end end end end end;if (v28>(700 -(208 + 490))) then if v42() then return true;end end if v44() then return true;end v20("Clear");end;