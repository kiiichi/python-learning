function() if (aura_env.LastUpdate and (aura_env.LastUpdate>(GetTime() -aura_env.config['UpdateFrequency']))) then return;end aura_env.LastUpdate=GetTime();local v2=GetTime();local v3=aura_env.OffCooldown;local v4=aura_env.OffCooldownNotCasting;local v5=aura_env.GetRemainingAuraDuration;local v6=aura_env.GetRemainingDebuffDuration;local v7=aura_env.GetRemainingSpellCooldown;local v8=aura_env.IsCasting;local v9=aura_env.GetPlayerStacks;local v10=aura_env.GetTargetStacks;local v11=aura_env.PlayerHasBuff;local v12=aura_env.TargetHasDebuff;local v13=aura_env.HasBloodlust;local v14=aura_env.GetSpellChargesFractional;local v15=aura_env.GetTimeToNextCharge;local v16=aura_env.GetTimeToFullCharges;local v17=aura_env.TargetTimeToXPct;local v18=aura_env.FightRemains;local v19=aura_env.IsAuraRefreshable;local v20=aura_env.KTrig;local v21=aura_env.KTrigCD;aura_env.FlagKTrigCD=true;local v23=aura_env.ids;if IsPlayerSpell(457472 -(44 + 386) ) then v23.ShadowCrash=458528 -(998 + 488) ;end aura_env.OutOfRange=false;local v25=WeakAuras.GetNumSetItemsEquipped(613 + 1314 );local v26=UnitPower("player",Enum.PowerType.Insanity);local v27=UnitPowerMax("player",Enum.PowerType.Insanity);local v28=0 + 0 ;local v29=818 -(201 + 571) ;local v30=1138 -(116 + 1022) ;local v31=0 -0 ;local v32=0 + 0 ;for v45=3 -2 ,142 -102  do local v46=859 -(814 + 45) ;local v47;while true do if (v46==(0 -0)) then v47="nameplate"   .. v45 ;if (UnitExists(v47) and  not UnitIsFriend("player",v47) and WeakAuras.CheckRange(v47,v29,"<=") and (UnitAffectingCombat(v47) or aura_env.config['BypassCombatRequirement'])) then local v66=0 + 0 ;local v67;while true do if (v66==(0 + 0)) then v28=v28 + (886 -(261 + 624)) ;v67=false;v66=1 -0 ;end if (v66==1) then for v81,v82 in ipairs(_G.KLIST.ShadowPriest) do if ((UnitName(v47)==v82) or (select(1086 -(1020 + 60) ,strsplit("-",UnitGUID(v47)))==v82)) then v67=true;break;end end if (v67==false) then if (WA_GetUnitDebuff(v47,v23.VampiricTouch,"PLAYER|HARMFUL")~=nil) then v31=v31 + 1 ;elseif (UnitClassification(v47)~="minus") then v30=v30 + 1 ;end if (WA_GetUnitDebuff(v47,v23.DevouringPlague,"PLAYER|HARMFUL")~=nil) then v32=v32 + 1 ;end end break;end end end break;end end end WeakAuras.ScanEvents("K_NEARBY_ENEMIES",v28);local v33=max(1423 -(630 + 793) ,aura_env.ShadowfiendExpiration-GetTime() );if ((UnitExists("target")==false) or (UnitCanAttack("player","target")==false)) then local v51=0 -0 ;while true do if (v51==(0 -0)) then WeakAuras.ScanEvents("K_TRIGED_EXTRA",{});v20("Clear",nil);v51=1 + 0 ;end if (v51==(3 -2)) then return;end end end local v34={};WeakAuras.ScanEvents("K_TRIGED_EXTRA",v34,nil);local v35={};v35.DrForcePrio=true;v35.MeForcePrio=true;v35.MaxVts=1759 -(760 + 987) ;v35.IsVtPossible=false;v35.HoldingCrash=false;local v41=function() local v48=1913 -(1789 + 124) ;while true do if (v48==(767 -(745 + 21))) then if (v17(0 + 0 ,165 -105 )>=(70 -52)) then v35.IsVtPossible=true;end v35.DotsUp=((v31 + ((1 + 7) * ((((GetTime() -aura_env.LastShadowCrash)<2) and (1 + 0)) or (1055 -(87 + 968)))))>=v35.MaxVts) or  not v35.IsVtPossible ;v48=8 -6 ;end if (v48==0) then v35.MaxVts=min(v28,11 + 1 );v35.IsVtPossible=false;v48=1;end if (v48==(4 -2)) then if (v35.HoldingCrash and IsPlayerSpell(v23.ShadowCrash)) then v35.HoldingCrash=(v35.MaxVts-v31)<4 ;end v35.ManualVtsApplied=((v31 + ((1421 -(447 + 966)) * (( not v35.HoldingCrash and 1) or (0 -0))))>=v35.MaxVts) or  not v35.IsVtPossible ;break;end end end;local v42=function() local v49=1817 -(1703 + 114) ;while true do if (v49==(702 -(376 + 325))) then if (v3(v23.ShadowCrash) and (( not v35.HoldingCrash and v19(v23.VampiricTouchDebuff)) or ((v6("target",v23.VampiricTouchDebuff)<=v17(0 -0 ,184 -124 )) and  not v11(v23.VoidformBuff)))) then if ((aura_env.config[tostring(v23.ShadowCrash)]==true) and aura_env.FlagKTrigCD) then v21("Shadow Crash");elseif (aura_env.config[tostring(v23.ShadowCrash)]~=true) then v20("Shadow Crash");return true;end end break;end if (v49==0) then if v41() then return true;end if (v4(v23.VampiricTouch) and v19(v23.VampiricTouchDebuff) and (v17(0,18 + 42 )>=18) and (v12(v23.VampiricTouchDebuff) or  not v35.DotsUp) and (v35.MaxVts>(0 -0)) and  not v35.ManualVtsApplied and  not ((GetTime() -aura_env.LastShadowCrash)<2) and  not v11(v23.EntropicRiftBuff)) then local v70=0;while true do if (v70==0) then v20("Vampiric Touch");return true;end end end v49=15 -(9 + 5) ;end end end;local v43=function() if (v4(v23.Halo) and IsPlayerSpell(v23.PowerSurgeTalent) and (((v33>(376 -(85 + 291))) and (v33>=4) and IsPlayerSpell(v23.Mindbender)) or ( not IsPlayerSpell(v23.Mindbender) and  not v3(v23.Shadowfiend)) or ((v28>2) and  not IsPlayerSpell(v23.InescapableTormentTalent)) or  not IsPlayerSpell(v23.DarkAscension)) and ((C_Spell.GetSpellCharges(v23.MindBlast).currentCharges==(1265 -(243 + 1022))) or  not v3(v23.VoidTorrent) or  not IsPlayerSpell(v23.VoidEruption) or (v7(v23.VoidEruption)>=((3.5 -2) * (4 + 0))) or (v11(v23.MindDevourerBuff) and IsPlayerSpell(v23.MindDevourerTalent)))) then if ((aura_env.config[tostring(v23.Halo)]==true) and aura_env.FlagKTrigCD) then v21("Halo");elseif (aura_env.config[tostring(v23.Halo)]~=true) then local v71=1180 -(1123 + 57) ;while true do if (v71==0) then v20("Halo");return true;end end end end if (v4(v23.VoidEruption) and (((((v33>(0 + 0)) and (v33>=(258 -(163 + 91)))) or ( not IsPlayerSpell(v23.Mindbender) and  not v3(v23.Shadowfiend)) or ((v28>(1932 -(1869 + 61))) and  not IsPlayerSpell(v23.InescapableTormentTalent))) and (C_Spell.GetSpellCharges(v23.MindBlast).currentCharges==0)) or (v11(v23.MindDevourerBuff) and IsPlayerSpell(v23.MindDevourerTalent)) or v11(v23.PowerSurgeBuff))) then if ((aura_env.config[tostring(v23.VoidEruption)]==true) and aura_env.FlagKTrigCD) then v21("Void Eruption");elseif (aura_env.config[tostring(v23.VoidEruption)]~=true) then local v72=0;while true do if (v72==0) then v20("Void Eruption");return true;end end end end if (v4(v23.DarkAscension) and (((v33>(0 + 0)) and (v33>=4)) or ( not IsPlayerSpell(v23.Mindbender) and  not v3(v23.Shadowfiend)) or ((v28>(6 -4)) and  not IsPlayerSpell(v23.InescapableTormentTalent))) and ((v32>=1) or (v26>=((((30 -10) -(5 * (( not IsPlayerSpell(v23.MindsEyeTalent) and 1) or 0))) + (5 * ((IsPlayerSpell(v23.DistortedRealityTalent) and (1 + 0)) or (0 -0)))) -((((v33>(0 + 0)) and 1) or 0) * (1476 -(1329 + 145))))))) then if ((aura_env.config[tostring(v23.DarkAscension)]==true) and aura_env.FlagKTrigCD) then v21("Dark Ascension");elseif (aura_env.config[tostring(v23.DarkAscension)]~=true) then local v73=971 -(140 + 831) ;while true do if (v73==0) then v20("Dark Ascension");return true;end end end end end;local v44=function() if (v28<(1853 -(1409 + 441))) then v35.DotsUp=v12(v23.VampiricTouchDebuff) or v8(v23.VampiricTouch) or ((GetTime() -aura_env.LastShadowCrash)<(720 -(15 + 703))) ;end if ((v18(60,v29)<(14 + 16)) or ((v17(438 -(262 + 176) ,1781 -(345 + 1376) )>(703 -(198 + 490))) and ( not v35.HoldingCrash or (v28>2)))) then if v43() then return true;end end if (v3(v23.Shadowfiend) and (v7(v23.Mindbender)==0) and (v7(v23.Voidwraith)==(0 -0)) and ((v12(v23.ShadowWordPain) and v35.DotsUp) or ((GetTime() -aura_env.LastShadowCrash)<2)) and ( not v3(v23.Halo) or  not IsPlayerSpell(v23.PowerSurgeTalent)) and ((v18(143 -83 ,v29)<(1236 -(696 + 510))) or (v17(0,125 -65 )>(1277 -(1091 + 171)))) and ( not IsPlayerSpell(v23.DarkAscension) or (v7(v23.DarkAscension)<(1.5 + 0)) or (v18(188 -128 ,v29)<(49 -34)))) then if ((aura_env.config[tostring(v23.Shadowfiend)]==true) and aura_env.FlagKTrigCD) then v21("Shadowfiend");elseif (aura_env.config[tostring(v23.Shadowfiend)]~=true) then local v74=374 -(123 + 251) ;while true do if (v74==(0 -0)) then v20("Shadowfiend");return true;end end end end if (v3(v23.ShadowWordDeath) and (UnitGetTotalAbsorbs("target")>(698 -(208 + 490))) and IsPlayerSpell(v23.DevourMatterTalent)) then local v53=0 + 0 ;while true do if (v53==(0 + 0)) then v20("Shadow Word Death");return true;end end end if (v4(v23.VoidBlast) and ((v6("target",v23.DevouringPlague)>=max(C_Spell.GetSpellInfo(v23.VoidBlast).castTime/1000 ,WeakAuras.gcdDuration())) or (v5("player",v23.EntropicRiftBuff)<=1.5) or ((select(8,UnitChannelInfo("player"))==v23.VoidTorrent) and IsPlayerSpell(v23.VoidEmpowermentTalent))) and (((v27-v26)>=(852 -(660 + 176))) or (v16(v23.MindBlast)<=1.5) or (v5("player",v23.EntropicRiftBuff)<=1.5))) then v20("Void Blast");return true;end if (v3(v23.DevouringPlague) and v11(v23.VoidformBuff) and IsPlayerSpell(v23.PerfectedFormTalent) and (v5("player",v23.VoidformBuff)<=max(1.5/(1 + (0.01 * UnitSpellHaste("player"))) ,0.75 + 0 )) and IsPlayerSpell(v23.VoidEruption)) then v20("Devouring Plague");return true;end if ((v7(v23.VoidBolt)==0) and  not v8(v23.VoidBolt) and (v11(v23.VoidformBuff) or v8(v23.VoidEruption)) and ((v27-v26)>(218 -(14 + 188))) and (v7(v23.VoidBolt)<=(675.1 -(534 + 141)))) then if ((aura_env.config[tostring(v23.VoidEruption)]==true) and aura_env.FlagKTrigCD) then v21("Void Bolt");elseif (aura_env.config[tostring(v23.VoidEruption)]~=true) then local v75=0;while true do if (v75==0) then v20("Void Bolt");return true;end end end end if (v3(v23.DevouringPlague) and (((v32<=(1 + 0)) and (v6("target",v23.DevouringPlague)<=1.5) and ( not IsPlayerSpell(v23.VoidEruption) or (v7(v23.VoidEruption)>=((1.5 + 0) * (3 + 0))))) or ((v27-v26)<=(73 -38)) or v11(v23.MindDevourerBuff) or v11(v23.EntropicRiftBuff) or (v11(v23.PowerSurgeBuff) and (v25>=(5 -1)) and IsPlayerSpell(v23.PowerSurgeTalent) and (aura_env.Archon4pcStacks<4) and v11(v23.AscensionBuff)))) then local v54=0 -0 ;while true do if (v54==0) then v20("Devouring Plague");return true;end end end if (v4(v23.VoidTorrent) and  not v35.HoldingCrash and (((v6("target",v23.DevouringPlagueDebuff)>=(2.5 + 0)) and ((v7(v23.DarkAscension)>=(8 + 4)) or  not IsPlayerSpell(v23.DarkAscension) or  not IsPlayerSpell(v23.VoidBlastTalent))) or ((v7(v23.VoidEruption)<=(399 -(115 + 281))) and IsPlayerSpell(v23.VoidEruption)))) then if ((aura_env.config[tostring(v23.VoidTorrent)]==true) and aura_env.FlagKTrigCD) then v21("Void Torrent");elseif (aura_env.config[tostring(v23.VoidTorrent)]~=true) then local v76=0 -0 ;while true do if (v76==(0 + 0)) then v20("Void Torrent");return true;end end end end if (v11(v23.VoidVolleyBuff) and ((v5("player",v23.VoidVolleyBuff)<=5) or (v11(v23.EntropicRiftBuff) and (v7(v23.VoidBlast)>v5("player",v23.EntropicRiftBuff))) or (v17(0 -0 ,60)<=(18 -13)))) then if ((aura_env.config[tostring(v23.VoidTorrent)]==true) and aura_env.FlagKTrigCD) then v21("Void Volley");elseif (aura_env.config[tostring(v23.VoidTorrent)]~=true) then local v77=867 -(550 + 317) ;while true do if (v77==(0 -0)) then v20("Void Volley");return true;end end end end if (v3(v23.MindFlay) and (v11(v23.MindFlayInsanityBuff))) then local v55=0 -0 ;while true do if (v55==(0 -0)) then v20("Mind Flay");return true;end end end if (v3(v23.ShadowCrash) and v19(v23.VampiricTouchDebuff) and  not v35.HoldingCrash and  not ((GetTime() -aura_env.LastShadowCrash)<(287 -(134 + 151)))) then if ((aura_env.config[tostring(v23.ShadowCrash)]==true) and aura_env.FlagKTrigCD) then v21("Shadow Crash");elseif (aura_env.config[tostring(v23.ShadowCrash)]~=true) then local v78=1665 -(970 + 695) ;while true do if (v78==(0 -0)) then v20("Shadow Crash");return true;end end end end if (v4(v23.VampiricTouch) and v19(v23.VampiricTouchDebuff) and (v17(1990 -(582 + 1408) ,60)>(41 -29)) and (v12(v23.VampiricTouchDebuff) or  not v35.DotsUp) and ((v35.MaxVts>(0 -0)) or (v28<=1)) and ((v7(v23.ShadowCrash)>=v6("target",v23.VampiricTouchDebuff)) or v35.HoldingCrash or  not IsPlayerSpell(v23.ShadowCrash)) and ( not ((GetTime() -aura_env.LastShadowCrash)<(7 -5)) or  not IsPlayerSpell(v23.ShadowCrash))) then v20("Vampiric Touch");return true;end if (v3(v23.MindBlast) and ((C_Spell.GetSpellCharges(v23.MindBlast).currentCharges>1) or  not v8(v23.MindBlast)) and ( not v11(v23.MindDevourerBuff) or  not IsPlayerSpell(v23.MindDevourerTalent) or (v3(v23.VoidEruption) and IsPlayerSpell(v23.VoidEruption)))) then local v56=0;while true do if (0==v56) then v20("Mind Blast");return true;end end end if v11(v23.VoidVolleyBuff) then local v57=1824 -(1195 + 629) ;while true do if (v57==0) then v20("Void Volley");return true;end end end if (v3(v23.DevouringPlague) and ((v11(v23.VoidformBuff) and IsPlayerSpell(v23.VoidEruption)) or v11(v23.PowerSurgeBuff) or IsPlayerSpell(v23.DistortedRealityTalent))) then local v58=0 -0 ;while true do if (v58==(241 -(187 + 54))) then v20("Devouring Plague");return true;end end end if (v4(v23.Halo) and (v28>(781 -(162 + 618)))) then if ((aura_env.config[tostring(v23.Halo)]==true) and aura_env.FlagKTrigCD) then v21("Halo");elseif (aura_env.config[tostring(v23.Halo)]~=true) then local v79=0 + 0 ;while true do if (v79==(0 + 0)) then v20("Halo");return true;end end end end if (v3(v23.ShadowCrash) and  not v35.HoldingCrash and IsPlayerSpell(v23.DescendingDarknessTalent)) then if ((aura_env.config[tostring(v23.ShadowCrash)]==true) and aura_env.FlagKTrigCD) then v21("Shadow Crash");elseif (aura_env.config[tostring(v23.ShadowCrash)]~=true) then v20("Shadow Crash");return true;end end if (v3(v23.ShadowWordDeath) and (((UnitHealth("target")/UnitHealthMax("target")) * (213 -113))<(20 + ((25 -10) * ((IsPlayerSpell(v23.DeathspeakerTalent) and (1 + 0)) or (1636 -(1373 + 263))))))) then local v59=1000 -(451 + 549) ;while true do if (v59==(0 + 0)) then v20("Shadow Word Death");return true;end end end if (v3(v23.ShadowWordDeath) and IsPlayerSpell(v23.InescapableTormentTalent) and (v33>0)) then local v60=0 -0 ;while true do if (v60==0) then v20("Shadow Word Death");return true;end end end if v3(v23.MindFlay) then local v61=0 -0 ;while true do if (v61==(1384 -(746 + 638))) then v20("Mind Flay");return true;end end end if v3(v23.DivineStar) then if ((aura_env.config[tostring(v23.DivineStar)]==true) and aura_env.FlagKTrigCD) then v21("Divine Star");elseif (aura_env.config[tostring(v23.DivineStar)]~=true) then local v80=0;while true do if (v80==0) then v20("Divine Star");return true;end end end end end;if (v28>(1 + 1)) then if v42() then return true;end end if v44() then return true;end v20("Clear");end;